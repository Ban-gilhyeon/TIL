## Kafka 용어 정리

| name                     | explain                                                              |
| ------------------------ | -------------------------------------------------------------------- |
| 주키퍼(Zookeeper)           | - 아파치 프로젝트 어플리케이션 이름<br>- 메타 데이터 관리 및 브로커의 정상 상태 점검(Health Check) 담당 |
| 카프카 <br>카프카 클러스터         | - 아파치 프로젝트 애플리케이션 이름<br>- 여러 대의 브로커를 구성한 클러스터를 의미                    |
| 브로커                      | - 카프카 어플리케이션이 설치된 서버 또는 노드                                           |
| 프로듀서<br>(Sender Client)  | - 카프카로 메세지를 보내는 역할을 하는 클라이언트를 총칭<br>- 메세지를 보내는 역할?                   |
| 컨슈머<br>(Receiver Client) | - 카프카에서 메세지를 꺼내가는 역할을 하는 클라이언트를 총칭<br>- 메세지를 받는 역할?                  |
| 토픽                       | - 카프카는 메세지 피드들을 토픽으로 구분<br>- 각 토픽의 이름은 카프카 내에서 고유함 (ID 느낌..?)        |
| 파티션                      | - 병렬 처리 및 고성능을 얻기 위해 하나의 토픽을 여러개로 나눔<br>- 번호는 0부터 시작                 |
| 세그먼트                     | - 프로듀서가 전송한 실제 메세지가 브로커의 로컬 디스크에 저장되는 파일                             |
| 메세지<br>레코드               | - 프로듀서가 브로커로 전송하거나 컨슈머가 읽어가는 데이터 조각                                  |

![[Pasted image 20250103002150.png]]

### 리플리케이션
- 각 메세지들을 여러개로 복제해서 `카프카 클러스터` 내의 `브로커`들에 분산 시키는 동작
- 하나의 `브로커`가 종료되더라도 카프카는 `안정성`을 유지할 수 있음
```
--replication-factor 3
```
옵션은 카프카 내 몇개의 리플리케이션을 유지하겠다는 의미 
위의 옵션은 원본을 포함한 리플리케이션이 3개 있다는 뜻 

- 리플리케이션 팩터 수가 커지만 안정성은 높아짐
- 브로커 리소스를 많이 사용
따라서 복제에 대한 오버헤드를 줄여서 효율적으로 사용하는 것을 권장 

- **테스트나 개발 환경** : 리플리케이션 팩터 수를 1로 설정
- **운영 환경 (로그성 메세지로서 약간의 유실 허용)** : 2로 설정
- **운영 환경 (유실을 허용하지 않음)** : 3으로 설정
- **4 ~ 5** :  카프카 내 동일한 리플리케이션이 4개 이상 존재해 디스크 공간을 많이 사용하게 되므로 이를 염두해두고 유의해서 늘려야함

### 파티션
![[Pasted image 20250103005232.png]]
- 하나의 `토픽`이 한 번에 처리할 수 있는 한계를 높이기 위해 토픽 하나를 여러 개로 나눠 병렬 처리가 가능하게 만든 것
- 분산 처리 가능
- 파티션 수만큼 `컨슈머`를 연결할 수 있음
- 파티션 번호는 0부터 시작
- 언제든 파티션을 나눌 수 있지만(늘릴 수) 절대로 줄일 수는 없음
- 2 ~ 4 정도 권장 

#### LAG
프로듀서가 보낸 메세지수(카프카에 남아 있는 메세지 수) - 컨슈머가 가져간 메세지 수
- 예 ) 
	- 프로듀서가 5개의 메세지를 카프카로 전송 
	- 컨슈머가 4개의 메세지만 가져감 
	- LAG = 5 - 4 , 1 이 됨
- LAG라는 지표를 통해 컨슈머에 지연을 확인할 수 있음 

### 세그먼트
프로듀서에 의해 브로커로 전송된 메세지는 토픽의 파티션에 저장되며, 
각 메세지들은 세그먼트라는 `로그 파일`의 형태로 브로커의 로컬 디스크에 저장

![[Pasted image 20250103005529.png]]

## 카프카의 핵심 개념
### 분산 시스템
- 단일 시스템이 갖지 못한 높은 성능을 목표
- 하나의 서버 또는 노드 등에 `장애`가 발생할 때 다른 서버 또는 노드가 대신 처리 -> 장애 대응 good
- 시스템 확장에 용이 
	- 브로커를 추가하는 방식으로 확장 가능

### 페이지 캐시
- 직접 디스크에 읽고 쓰는 대신 물리 메모리 중 어플리케이션이 사용하지 않는 일부 잔여 메모리를 활용
- 디스크 I/O에 대한 접근이 줄어듬 -> 성능 good 
![[Pasted image 20250103010113.png]]
OS에서 HDD에 있는 프로그램의 일부를 RAM으로 올려서(캐싱) 사용하는거랑 비슷

### 배치 전송 + 압축 전송
- 배치 전송
	- Insert 할 때 batch Insert와 같이 묶어서 메세지를 전송하는 방법
- 압축 전송
	- 메일 보낼 때 zip으로 압축하는 것과 같음 
	- 압축 타입 
		- 높은 압축률 
			- `gzip`, `snappy`
		- 빠른 응답 속도 
			-  `lz4`, `zstd`

